chatbot_id: 340855e9-3d8d-46b5-9521-30d8ac865fca
 
# test_sets:
#   - test_set: Easy Questions
#     questions:
#     - natural_question: Show all patients
#       expected_sql: SELECT * FROM patients;
#     - natural_question: List patient names and contact numbers
#       expected_sql: SELECT first_name, last_name, contact_number FROM patients;
#     - natural_question: Find all providers who specialize in Cardiology
#       expected_sql: |-
#         SELECT first_name, last_name FROM providers WHERE specialty = 'Cardiology';
#     - natural_question: Show all admissions marked as emergency
#       expected_sql: SELECT * FROM admissions WHERE is_emergency = true;
#     - natural_question: Get all diagnoses requiring tests
#       expected_sql: |-
#         SELECT diagnosis_code, diagnosis_name FROM diagnoses WHERE test_required = true;
#     - natural_question: Show all insurance providers
#       expected_sql: SELECT * FROM insurance_providers;
#     - natural_question: List insurance providers and their contact numbers
#       expected_sql: |-
#         SELECT insurance_name, contact_number
#         FROM insurance_providers;
#     - natural_question: Count the total number of patients
#       expected_sql: SELECT COUNT(*) AS total_patients FROM patients;
 
 
#   - test_set: Medium Questions
#     questions:
#     - natural_question: Find the number of patients admitted in the last 30 days
#       expected_sql: |-
#        SELECT COUNT(*) AS admissions_last_30_days
#         FROM admissions
#         WHERE admission_date >= CURRENT_DATE - INTERVAL '30 days';
#     - natural_question: Show the number of visits per provider
#       expected_sql: |-
#         SELECT provider_id, COUNT(*) AS total_visits
#         FROM visits
#         GROUP BY provider_id;
#     - natural_question: Get the most common diagnoses
#       expected_sql: |-
#         SELECT d.diagnosis_name, COUNT(*) AS occurrence
#         FROM patient_diagnoses pd
#         JOIN diagnoses d ON pd.diagnosis_id = d.diagnosis_id
#         GROUP BY d.diagnosis_name
#         ORDER BY occurrence DESC;
#     - natural_question: Find the average length of hospital stay
#       expected_sql: |-
#         SELECT AVG(discharge_date - admission_date) AS avg_stay
#         FROM admissions
#         WHERE discharge_date IS NOT NULL;
#     - natural_question: Count the number of patients covered by each insurance provider
#       expected_sql: |-
#         SELECT i.insurance_name, COUNT(DISTINCT pi.patient_id) AS patients_covered
#         FROM patient_insurance pi
#         JOIN insurance_providers i ON pi.insurance_id = i.insurance_id
#         GROUP BY i.insurance_name;
#     - natural_question: Find the percentage of insured patients
#       expected_sql: |-
#         SELECT
#             ROUND((COUNT(DISTINCT pi.patient_id) * 100.0 / COUNT(DISTINCT p.patient_id)), 2)
#             AS insured_percentage,
#             ROUND(((COUNT(DISTINCT p.patient_id) - COUNT(DISTINCT pi.patient_id)) * 100.0 / COUNT(DISTINCT p.patient_id)), 2)
#             AS uninsured_percentage
#         FROM patients p
#         LEFT JOIN patient_insurance pi ON p.patient_id = pi.patient_id;
#     - natural_question: Show the top 3 insurance providers by number of patients
#         covered
#       expected_sql: |-
#         SELECT i.insurance_name, COUNT(DISTINCT pi.patient_id) AS patients_covered
#         FROM patient_insurance pi
#         JOIN insurance_providers i ON pi.insurance_id = i.insurance_id
#         GROUP BY i.insurance_name
#         ORDER BY patients_covered DESC
#         LIMIT 3;
 
 
#   - test_set: Complex Questions
#     questions:
#     - natural_question: Find the top 5 most prescribed medications
#       expected_sql: |-
#         SELECT drug_name, COUNT(*) AS prescription_count
#         FROM medications
#         GROUP BY drug_name
#         ORDER BY prescription_count DESC
#         LIMIT 5;
#     - natural_question: Show the percentage of emergency admissions out of total
#         admissions
#       expected_sql: |-
#         SELECT
#           (COUNT(*) FILTER (WHERE is_emergency = TRUE) * 100.0 / COUNT(*)) AS emergency_percentage
#         FROM admissions;
#     - natural_question: Find the average number of visits per patient
#       expected_sql: |-
#         SELECT patient_id,visit_count AS avg_visits_per_patient
#         FROM (
#           SELECT patient_id, COUNT(*) AS visit_count
#           FROM visits
#           GROUP BY patient_id
#         ) sub;
#     - natural_question: Show patients with more than one diagnosis
#       expected_sql: |-
#         SELECT patient_id, COUNT(diagnosis_id) AS total_diagnoses
#         FROM patient_diagnoses
#         GROUP BY patient_id
#         HAVING COUNT(diagnosis_id) > 1;
#     - natural_question: Find the readmission rate (patients admitted again within 30 days of discharge)
#       expected_sql: |-
#         SELECT
#           (COUNT(*) * 100.0 / (SELECT COUNT(*) FROM admissions)) AS readmission_rate
#         FROM admissions a1
#         JOIN admissions a2
#           ON a1.patient_id = a2.patient_id
#         AND a2.admission_date BETWEEN a1.discharge_date AND a1.discharge_date + INTERVAL '30 days';
#     - natural_question: Show the top 3 specialties with the most patients
#       expected_sql: |-
#         SELECT p.specialty, COUNT(DISTINCT v.patient_id) AS patient_count
#         FROM providers p
#         JOIN visits v ON p.provider_id = v.provider_id
#         GROUP BY p.specialty
#         ORDER BY patient_count DESC
#         LIMIT 3;
#     - natural_question: Find the average prescriptions per visit
#       expected_sql: |-
#         SELECT AVG(meds_per_visit) AS avg_prescriptions_per_visit
#         FROM (
#           SELECT visit_id, COUNT(*) AS meds_per_visit
#           FROM medications
#           GROUP BY visit_id
#         ) sub;
#     - natural_question: Find the most common diagnoses covered by each insurance provider
#       expected_sql: |-
#         SELECT i.insurance_name, d.diagnosis_name, COUNT(*) AS cases
#         FROM patient_diagnoses pd
#         JOIN diagnoses d ON pd.diagnosis_id = d.diagnosis_id
#         JOIN patient_insurance pi ON pd.patient_id = pi.patient_id
#         JOIN insurance_providers i ON pi.insurance_id = i.insurance_id
#         GROUP BY i.insurance_name, d.diagnosis_name
#         ORDER BY i.insurance_name, cases DESC;
#     - natural_question: Show the average number of visits per insured patient
#       expected_sql: |-
#         SELECT patient_id, visit_count AS avg_visits_per_insured_patient
#         FROM (
#           SELECT pi.patient_id, COUNT(v.visit_id) AS visit_count
#           FROM patient_insurance pi
#           JOIN visits v ON pi.patient_id = v.patient_id
#           GROUP BY pi.patient_id
#         ) sub;
#     - natural_question: Find the top 5 insurance providers by average length of patient stay
#       expected_sql: |-
#         SELECT i.insurance_name,
#               AVG(a.discharge_date - a.admission_date) AS avg_stay
#         FROM admissions a
#         JOIN patient_insurance pi ON a.patient_id = pi.patient_id
#         JOIN insurance_providers i ON pi.insurance_id = i.insurance_id
#         WHERE a.discharge_date IS NOT NULL
#         GROUP BY i.insurance_name
#         ORDER BY avg_stay DESC
#         LIMIT 5;
 
 
# # test_sets:
# #   - test_set: Easy Questions
# #     questions:
# #     - natural_question: Display all members
# #       expected_sql: SELECT * FROM patients;
# #     - natural_question: Show full names and phone numbers of patients
# #       expected_sql: SELECT first_name, last_name, contact_number FROM patients;
# #     - natural_question: List doctors whose specialty is Cardiology
# #       expected_sql: |-
# #         SELECT first_name, last_name FROM providers WHERE specialty = 'Cardiology';
# #     - natural_question: Retrieve hospitalizations flagged as emergency
# #       expected_sql: SELECT * FROM admissions WHERE is_emergency = true;
# #     - natural_question: Show all conditions where lab investigation is needed
# #       expected_sql: |-
# #         SELECT diagnosis_code, diagnosis_name FROM diagnoses WHERE test_required = true;
# #     - natural_question: Retrieve every insurer listed
# #       expected_sql: SELECT * FROM insurance_providers;
# #     - natural_question: Show insurers with their phone details
# #       expected_sql: |-
# #         SELECT insurance_name, contact_number
# #         FROM insurance_providers;
# #     - natural_question: Get number of individuals registered as patients
# #       expected_sql: SELECT COUNT(*) AS total_patients FROM patients;
 
# #   - test_set: Medium Questions
# #     questions:
# #     - natural_question: Count enrollees hospitalized in the past 30 days
# #       expected_sql: |-
# #         SELECT COUNT(*) AS admissions_last_30_days
# #         FROM admissions
# #         WHERE admission_date >= CURRENT_DATE - INTERVAL '30 days';
# #     - natural_question: List doctors with their total consultations
# #       expected_sql: |-
# #         SELECT provider_id, COUNT(*) AS total_visits
# #         FROM visits
# #         GROUP BY provider_id;
# #     - natural_question: Retrieve most frequent diseases recorded
# #       expected_sql: |-
# #         SELECT d.diagnosis_name, COUNT(*) AS occurrence
# #         FROM patient_diagnoses pd
# #         JOIN diagnoses d ON pd.diagnosis_id = d.diagnosis_id
# #         GROUP BY d.diagnosis_name
# #         ORDER BY occurrence DESC;
# #     - natural_question: Retrieve average number of days admitted
# #       expected_sql: |-
# #         SELECT AVG(discharge_date - admission_date) AS avg_stay
# #         FROM admissions
# #         WHERE discharge_date IS NOT NULL;
# #     - natural_question: Retrieve total members covered per insurer
# #       expected_sql: |-
# #         SELECT i.insurance_name, COUNT(DISTINCT pi.patient_id) AS patients_covered
# #         FROM patient_insurance pi
# #         JOIN insurance_providers i ON pi.insurance_id = i.insurance_id
# #         GROUP BY i.insurance_name;
# #     - natural_question: Calculate proportion of covered members vs overall enrollees
# #       expected_sql: |-
# #         SELECT
# #             ROUND((COUNT(DISTINCT pi.patient_id) * 100.0 / COUNT(DISTINCT p.patient_id)), 2)
# #             AS insured_percentage,
# #             ROUND(((COUNT(DISTINCT p.patient_id) - COUNT(DISTINCT pi.patient_id)) * 100.0 / COUNT(DISTINCT p.patient_id)), 2)
# #             AS uninsured_percentage
# #         FROM patients p
# #         LEFT JOIN patient_insurance pi ON p.patient_id = pi.patient_id;
# #     - natural_question: List top 3 payers with highest enrollee coverage
# #       expected_sql: |-
# #         SELECT i.insurance_name, COUNT(DISTINCT pi.patient_id) AS patients_covered
# #         FROM patient_insurance pi
# #         JOIN insurance_providers i ON pi.insurance_id = i.insurance_id
# #         GROUP BY i.insurance_name
# #         ORDER BY patients_covered DESC
# #         LIMIT 3;
 
# #   - test_set: Complex Questions
# #     questions:
# #     - natural_question: Show most frequently ordered drugs
# #       expected_sql: |-
# #         SELECT drug_name, COUNT(*) AS prescription_count
# #         FROM medications
# #         GROUP BY drug_name
# #         ORDER BY prescription_count DESC
# #         LIMIT 5;
# #     - natural_question: Calculate share of emergency hospitalizations
# #       expected_sql: |-
# #         SELECT
# #           (COUNT(*) FILTER (WHERE is_emergency = TRUE) * 100.0 / COUNT(*)) AS emergency_percentage
# #         FROM admissions;
# #     - natural_question: Show mean encounters per enrollee
# #       expected_sql: |-
# #         SELECT patient_id,visit_count AS avg_visits_per_patient
# #         FROM (
# #           SELECT patient_id, COUNT(*) AS visit_count
# #           FROM visits
# #           GROUP BY patient_id
# #         ) sub;
# #     - natural_question: Display members with more than one disease
# #       expected_sql: |-
# #         SELECT patient_id, COUNT(diagnosis_id) AS total_diagnoses
# #         FROM patient_diagnoses
# #         GROUP BY patient_id
# #         HAVING COUNT(diagnosis_id) > 1;
# #     - natural_question: Calculate percentage of patients readmitted within 30 days
# #       expected_sql: |-
# #         SELECT
# #           (COUNT(*) * 100.0 / (SELECT COUNT(*) FROM admissions)) AS readmission_rate
# #         FROM admissions a1
# #         JOIN admissions a2
# #           ON a1.patient_id = a2.patient_id
# #         AND a2.admission_date BETWEEN a1.discharge_date AND a1.discharge_date + INTERVAL '30 days';
# #     - natural_question: Retrieve specialties with highest enrollee visits
# #       expected_sql: |-
# #         SELECT p.specialty, COUNT(DISTINCT v.patient_id) AS patient_count
# #         FROM providers p
# #         JOIN visits v ON p.provider_id = v.provider_id
# #         GROUP BY p.specialty
# #         ORDER BY patient_count DESC
# #         LIMIT 3;
# #     - natural_question: Retrieve average number of medicines per encounter
# #       expected_sql: |-
# #         SELECT AVG(meds_per_visit) AS avg_prescriptions_per_visit
# #         FROM (
# #           SELECT visit_id, COUNT(*) AS meds_per_visit
# #           FROM medications
# #           GROUP BY visit_id
# #         ) sub;
# #     - natural_question: Show top conditions insured by each payer
# #       expected_sql: |-
# #         SELECT i.insurance_name, d.diagnosis_name, COUNT(*) AS cases
# #         FROM patient_diagnoses pd
# #         JOIN diagnoses d ON pd.diagnosis_id = d.diagnosis_id
# #         JOIN patient_insurance pi ON pd.patient_id = pi.patient_id
# #         JOIN insurance_providers i ON pi.insurance_id = i.insurance_id
# #         GROUP BY i.insurance_name, d.diagnosis_name
# #         ORDER BY i.insurance_name, cases DESC;
# #     - natural_question: Calculate visits per covered member
# #       expected_sql: |-
# #         SELECT patient_id, visit_count AS avg_visits_per_insured_patient
# #         FROM (
# #           SELECT pi.patient_id, COUNT(v.visit_id) AS visit_count
# #           FROM patient_insurance pi
# #           JOIN visits v ON pi.patient_id = v.patient_id
# #           GROUP BY pi.patient_id
# #         ) sub;
# #     - natural_question: Show top insurers ranked by mean hospitalization duration
# #       expected_sql: |-
# #         SELECT i.insurance_name,
# #               AVG(a.discharge_date - a.admission_date) AS avg_stay
# #         FROM admissions a
# #         JOIN patient_insurance pi ON a.patient_id = pi.patient_id
# #         JOIN insurance_providers i ON pi.insurance_id = i.insurance_id
# #         WHERE a.discharge_date IS NOT NULL
# #         GROUP BY i.insurance_name
# #         ORDER BY avg_stay DESC
# #         LIMIT 5;
test_sets:
- test_set: Easy Queries
  questions:
    - natural_question: Show all departments.
      expected_sql: SELECT * FROM Departments;

    - natural_question: List employee names and their locations.
      expected_sql: SELECT first_name, last_name, location FROM Employees;

    - natural_question: Find all clients from Bangalore.
      expected_sql: SELECT client_name FROM Clients WHERE location = 'Bangalore';

    - natural_question: Get names of projects that are Active.
      expected_sql: SELECT proj_name FROM Projects WHERE status = 'Active';

    - natural_question: Show email and phone of employees working in Hyderabad.
      expected_sql: SELECT first_name, last_name, email, phone FROM Employees WHERE location = 'Hyderabad';

    - natural_question: Find all invoices raised in September 2025.
      expected_sql: SELECT * FROM Invoices WHERE invoice_period = 'Sep 2025';

    - natural_question: Show all employees with their designation and department.
      expected_sql: |
        SELECT e.first_name, e.last_name, e.designation, d.dept_name
        FROM Employees e
        JOIN Departments d ON e.dept_id = d.dept_id;

    - natural_question: List all active projects with their client names.
      expected_sql: |
        SELECT p.proj_name, c.client_name
        FROM Projects p
        JOIN Clients c ON p.client_id = c.client_id
        WHERE p.status = 'Active';

    - natural_question: Show email IDs of employees who work in the DevOps department.
      expected_sql: |
        SELECT e.first_name, e.last_name, e.email
        FROM Employees e
        JOIN Departments d ON e.dept_id = d.dept_id
        WHERE d.dept_name = 'DevOps';


- test_set: Medium Queries
  questions:
    - natural_question: Show total number of employees in each department.
      expected_sql: |
        SELECT d.dept_name, COUNT(e.emp_id) AS total_employees
        FROM Departments d
        LEFT JOIN Employees e ON d.dept_id = e.dept_id
        GROUP BY d.dept_name;

    - natural_question: Get total project revenue for each client.
      expected_sql: |
        SELECT c.client_name, SUM(p.project_revenue) AS total_revenue
        FROM Clients c
        JOIN Projects p ON c.client_id = p.client_id
        GROUP BY c.client_name;

    - natural_question: List employees working on the "AI Chatbot Banking" project.
      expected_sql: |
        SELECT e.first_name, e.last_name
        FROM Employees e
        JOIN ProjectsAllocation pa ON e.emp_id = pa.emp_id
        JOIN Projects p ON pa.proj_id = p.proj_id
        WHERE p.proj_name = 'AI Chatbot Banking';

    - natural_question: Show all projects handled by the Cloud department.
      expected_sql: |
        SELECT proj_name
        FROM Projects
        WHERE dept_id = (SELECT dept_id FROM Departments WHERE dept_name = 'Cloud');

    - natural_question: Find invoices created in 2022.
      expected_sql: SELECT * FROM Invoices WHERE EXTRACT(YEAR FROM created_date) = 2022;

    - natural_question: Show employees and their project count.
      expected_sql: |
        SELECT e.first_name, e.last_name, COUNT(pa.proj_id) AS project_count
        FROM Employees e
        LEFT JOIN ProjectsAllocation pa ON e.emp_id = pa.emp_id
        GROUP BY e.emp_id;

    - natural_question: Find employees who joined after 2022.
      expected_sql: |
        SELECT first_name, last_name, hire_date
        FROM Employees
        WHERE hire_date > '2022-01-01';

    - natural_question: Show total invoices raised per project.
      expected_sql: |
        SELECT p.proj_name, COUNT(i.invoice_id) AS total_invoices
        FROM Projects p
        LEFT JOIN Invoices i ON p.proj_id = i.proj_id
        GROUP BY p.proj_name;

    - natural_question: Find clients with more than 2 active projects.
      expected_sql: |
        SELECT c.client_name, COUNT(p.proj_id) AS active_projects
        FROM Clients c
        JOIN Projects p ON c.client_id = p.client_id
        WHERE p.status = 'Active'
        GROUP BY c.client_name
        HAVING COUNT(p.proj_id) > 2;


- test_set: Complex Queries
  questions:
    - natural_question: Find the top 3 highest revenue projects and their clients.
      expected_sql: |
        SELECT p.proj_name, c.client_name, p.project_revenue
        FROM Projects p
        JOIN Clients c ON p.client_id = c.client_id
        ORDER BY p.project_revenue DESC
        LIMIT 3;

    - natural_question: Show employees working on more than 2 projects.
      expected_sql: |
        SELECT e.first_name, e.last_name, COUNT(pa.proj_id) AS total_projects
        FROM Employees e
        JOIN ProjectsAllocation pa ON e.emp_id = pa.emp_id
        GROUP BY e.emp_id
        HAVING COUNT(pa.proj_id) > 2;

    - natural_question: Show total invoice amount and total paid amount for each client.
      expected_sql: |
        SELECT c.client_name, 
                SUM(i.invoice_amount) AS total_invoiced, 
                SUM(i.paid_amount) AS total_paid
        FROM Invoices i
        JOIN Clients c ON i.client_id = c.client_id
        GROUP BY c.client_name;

    - natural_question: Show all employees who worked on projects for "HDFC Bank".
      expected_sql: |
        SELECT DISTINCT e.first_name, e.last_name
        FROM Employees e
        JOIN ProjectsAllocation pa ON e.emp_id = pa.emp_id
        JOIN Projects p ON pa.proj_id = p.proj_id
        JOIN Clients c ON p.client_id = c.client_id
        WHERE c.client_name = 'HDFC Bank';

    - natural_question: Get average salary of employees department-wise.
      expected_sql: |
        SELECT d.dept_name, AVG(e.salary) AS avg_salary
        FROM Departments d
        JOIN Employees e ON d.dept_id = e.dept_id
        GROUP BY d.dept_name;

    - natural_question: Find all employees who have not been allocated to any project.
      expected_sql: |
        SELECT e.first_name, e.last_name
        FROM Employees e
        LEFT JOIN ProjectsAllocation pa ON e.emp_id = pa.emp_id
        WHERE pa.emp_id IS NULL;

    - natural_question: Show client-wise revenue contribution with percentage of total revenue.
      expected_sql: |
        SELECT c.client_name,
                SUM(p.project_revenue) AS revenue,
                ROUND(SUM(p.project_revenue) * 100.0 / (SELECT SUM(project_revenue) FROM Projects), 2) AS percent_contribution
        FROM Clients c
        JOIN Projects p ON c.client_id = p.client_id
        GROUP BY c.client_name;

    - natural_question: Find the outstanding balance (invoice_amount - paid_amount) for each client.
      expected_sql: |
        SELECT c.client_name, 
                SUM(i.invoice_amount - i.paid_amount) AS outstanding_balance
        FROM Invoices i
        JOIN Clients c ON i.client_id = c.client_id
        GROUP BY c.client_name;

    - natural_question: Show the top 5 employees who worked on the highest number of projects.
      expected_sql: |
        SELECT e.first_name, e.last_name, COUNT(pa.proj_id) AS total_projects
        FROM Employees e
        JOIN ProjectsAllocation pa ON e.emp_id = pa.emp_id
        GROUP BY e.emp_id
        ORDER BY total_projects DESC
        LIMIT 5;

    - natural_question: Get month-wise total invoice amount and paid amount for 2024.
      expected_sql: |
        SELECT TO_CHAR(created_date, 'Mon YYYY') AS month,
                SUM(invoice_amount) AS total_invoiced,
                SUM(paid_amount) AS total_paid
        FROM Invoices
        WHERE EXTRACT(YEAR FROM created_date) = 2024
        GROUP BY TO_CHAR(created_date, 'Mon YYYY')
        ORDER BY MIN(created_date);

    - natural_question: Find the client with the highest outstanding balance.
      expected_sql: |
        SELECT c.client_name,
                SUM(i.invoice_amount - i.paid_amount) AS outstanding_balance
        FROM Clients c
        JOIN Invoices i ON c.client_id = i.client_id
        GROUP BY c.client_name
        ORDER BY outstanding_balance DESC
        LIMIT 1;

    - natural_question: Show revenue contribution of each department across all projects.
      expected_sql: |
        SELECT d.dept_name,
                SUM(p.project_revenue) AS total_revenue,
                ROUND(SUM(p.project_revenue) * 100.0 / (SELECT SUM(project_revenue) FROM Projects), 2) AS percent_contribution
        FROM Departments d
        JOIN Projects p ON d.dept_id = p.dept_id
        GROUP BY d.dept_name;